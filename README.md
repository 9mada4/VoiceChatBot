# VoiceChatBot

MacのChatGPTアプリを**完全音声操作**するための自動化ツールです。ターミナルでのキーボード入力は一切不要で、全ての操作を音声のみで制御できます。

## 主な特徴

- **🎤 完全音声制御**: ターミナル入力（y/n、Enterキー等）を完全廃止
- **🔄 2つの独立音声システム**: 
  - **音声入力①**: macOS純正（ChatGPT質問入力用）
  - **音声入力②**: Whisper独立音声認識（制御コマンド用）
- **🤖 自動読み上げ**: ChatGPTの回答を音声で出力
- **🔗 連続対話**: 音声のみで継続確認・質問繰り返し

## システム構成

### 音声入力①（macOS純正）
- **用途**: ChatGPTへの質問入力
- **制御**: コマンドキー2回押し（自動化）
- **動作**: macOSの標準音声入力機能を使用

### 音声入力②（独立Whisper）
- **用途**: システム制御（はい/いいえ、継続確認等）
- **制御**: macOSの`rec`コマンド + Whisper音声認識
- **動作**: ChatGPT入力とは完全に独立

## 必要な環境

- **OS**: macOS 10.14以降
- **Python**: 3.9以降（3.13推奨）
- **アプリ**: ChatGPTアプリ（Mac版）
- **権限**: アクセシビリティ権限
- **音声**: macOS音声入力の有効化

## インストールと初期設定

### 1. リポジトリのクローンと依存関係インストール

```bash
git clone <repository-url>
cd VoiceChatBot
chmod +x setup.sh
./setup.sh
```

### 2. システム権限の設定

#### アクセシビリティ権限
1. **システム環境設定** > **セキュリティとプライバシー** > **プライバシー** > **アクセシビリティ**
2. ターミナル（このアプリを実行するアプリ）にチェックを入れる
3. 必要に応じてPythonやVS Codeにも権限を付与

#### 音声入力の有効化
1. **システム環境設定** > **キーボード** > **音声入力**
2. 音声入力を **「オン」** にする
3. ショートカットが **「右コマンドキーを2回押す」** になっていることを確認
4. **「拡張音声入力」** をオンにする（推奨）

#### macOS録音ツールの確認
```bash
# 録音機能の確認（SOX必要）
brew install sox
rec --version
```

### 3. ChatGPTアプリの準備
- ChatGPTアプリを起動
- ログインしてチャット画面を開く
- チャット入力欄がアクティブな状態にする

## 使用方法（完全音声操作）

### 基本的な起動手順

```bash
cd VoiceChatBot
python3 voice_chat_bot.py
```

### 📝 完全音声ワークフロー

#### 1. **起動・開始確認**
- アプリ起動後、「準備ができたら『はい』と話してください」という指示
- 🎤 **音声②** で **「はい」** と話す → 開始

#### 2. **セットアップフェーズ**
- 指示: 「ChatGPTアプリのウィンドウを選択し、チャット入力欄をクリック」
- 手動でChatGPTアプリのチャット欄をクリック
- 🎤 **音声②** で **「はい」** と話す → セットアップ完了

#### 3. **質問フェーズ**
- システムが自動的に **音声入力①（macOS純正）** を起動
- 🎤 **音声①** で ChatGPTに質問を話す
- 音声入力が自動的に終了・送信される

#### 4. **回答取得フェーズ**
- ChatGPTの回答完了を待つ
- 手動で回答をコピー（Cmd+A → Cmd+C）
- 🎤 **音声②** で **「はい」** と話す → 回答読み上げ開始

#### 5. **継続確認フェーズ**
- システムが「次の質問をしますか？」と音声で質問
- 🎤 **音声②** で **「はい」**（継続）または **「いいえ」**（終了）

### 🎯 音声コマンド

#### 音声②で認識される「はい」コマンド
- `はい` / `hai` / `yes`
- `うん` / `そうです` / `オッケー` / `ok`
- `そう`

#### 音声②で認識される「いいえ」コマンド  
- `いいえ` / `いえ` / `no`
- `だめ` / `やめ` / `キャンセル`

## 技術仕様

### システム構成図
```
[ユーザー] 
    ↓ 音声①（ChatGPT質問）
[macOS純正音声入力] → [ChatGPTアプリ]
    ↓ 自動制御                ↓ 回答
[VoiceChatBot] ← [クリップボード] ← [手動コピー]
    ↓ 読み上げ               ↑ 制御
[macOS say] ← [音声②コマンド] ← [Whisper音声認識]
    ↓ 音声出力
[ユーザー]
```

### 主要機能

#### NativeDictationController
- macOS純正音声入力の自動制御
- プロセス監視による状態確認
- コマンドキー2回押しの自動化

#### VoiceCommandRecognizer  
- 独立した音声認識システム
- macOS `rec`コマンド + Whisper
- 「はい/いいえ」判定とフォールバック処理

#### ChatGPTResponseExtractor
- クリップボード経由での回答取得
- macOS Pasteboard API使用
- 重複検出機能

### ファイル構成
```
VoiceChatBot/
├── voice_chat_bot.py          # メインアプリケーション
├── requirements.txt            # Python依存関係
├── setup.sh                   # セットアップスクリプト
├── README.md                  # このドキュメント
├── voice_chat_bot.py          # 初期版（参考用）
├── advanced_voice_bot.py      # 発展版（参考用）
└── test_voice_functions.py    # テスト用スクリプト
```

## トラブルシューティング

### 🎤 音声認識関連

#### 音声入力①（macOS純正）が起動しない
- **確認項目**:
  - システム環境設定 > キーボード > 音声入力が「オン」
  - ショートカットが「右コマンドキーを2回押す」
  - アクセシビリティ権限が付与されている
- **解決方法**: 手動でコマンドキー2回押しをテストする

#### 音声入力②（Whisper）が認識しない
- **確認項目**:
  - `rec`コマンドがインストールされている（`brew install sox`）
  - faster-whisperが正しくインストールされている
  - マイクへのアクセス権限がある
- **解決方法**: 
```bash
# 音声認識テスト
python3 -c "from faster_whisper import WhisperModel; print('OK')"

# 録音テスト  
rec test.wav trim 0 3
```

### 🔧 権限・設定関連

#### アクセシビリティ権限エラー
```
Privacy warning: macOS requires permission to control other applications
```
- **解決方法**:
  1. システム環境設定 > セキュリティとプライバシー > プライバシー > アクセシビリティ
  2. ターミナル・Python・VS Code等に権限を付与
  3. アプリを再起動

#### ChatGPTアプリが認識されない
- **確認項目**:
  - ChatGPTアプリが最新版
  - アプリがアクティブウィンドウになっている
  - チャット画面が開いている
- **解決方法**: ChatGPTアプリを再起動してウィンドウを前面に

### 🔊 読み上げ関連

#### 読み上げ音声が出ない
- **確認項目**:
  - システムの音量設定
  - 他のアプリが音声出力を使用していない
  - macOS `say`コマンドが動作する
- **テスト方法**:
```bash
say "テスト音声です"
```

### ⚠️ 一般的な問題

#### アプリが途中で停止する
- **ログ確認**: `voice_chat_bot.log`ファイルを確認
- **再起動**: `Ctrl+C`で終了後、再起動
- **音声入力リセット**: 手動でコマンドキー2回押しで音声入力をリセット

#### 「faster-whisper」インポートエラー
```bash
pip3 install --upgrade faster-whisper
# または
pip3 install --force-reinstall faster-whisper
```

#### 無限ループ・応答なし
- **緊急停止**: `Ctrl+C`
- **プロセス確認**: 
```bash
ps aux | grep python
kill [PID]  # 必要に応じて
```

## 開発・カスタマイズ

### 音声認識精度の調整
`voice_chat_bot.py`の以下の部分を編集:
```python
# 録音時間の調整（デフォルト5秒）
audio_file = self.record_audio_macos(duration=5)  # 5秒 → 7秒等

# 再試行時の録音時間（デフォルト4秒）
audio_file = self.record_audio_macos(duration=4)  # 4秒 → 6秒等

# 認識語彙の追加
yes_commands = ['はい', 'hai', 'yes', 'うん', 'そうです', 'オッケー', 'ok', 'そう']
```

### ログレベルの変更
```python
logging.basicConfig(level=logging.DEBUG)  # より詳細なログ
```

### Whisperモデルの変更
```python
self.model = WhisperModel("small", device="cpu")  # tiny → small（精度向上）
```

## 今後の開発予定

### 🎯 短期目標
- [ ] ChatGPT回答の自動検出（Accessibility API）
- [ ] 音声認識精度の向上
- [ ] エラーハンドリングの強化
- [ ] 設定ファイル対応

### 🚀 中期目標  
- [ ] 複数音声入力デバイス対応
- [ ] 音声コマンドの拡張（質問カテゴリ指定等）
- [ ] ログ保存・履歴機能
- [ ] GUI版の開発

### 💡 長期目標
- [ ] 他のAIチャットサービス対応
- [ ] 音声合成音質の改善
- [ ] プラグインシステム
- [ ] モバイル版対応

## 貢献・フィードバック

### バグ報告
Issueで以下の情報と共に報告してください:
- macOSバージョン
- Pythonバージョン  
- エラーログ（`voice_chat_bot.log`）
- 再現手順

### 機能提案
新機能のアイデアをIssueで共有してください。

### プルリクエスト
1. フォークしてブランチを作成
2. 機能追加・修正を実装
3. テストを追加・実行  
4. プルリクエストを作成

## ライセンス

MIT License - 詳細は`LICENSE`ファイルを参照

## 作成者・クレジット

- **開発**: VoiceChatBot Project
- **音声認識**: faster-whisper (OpenAI Whisper)
- **TTS**: macOS標準 say コマンド
- **UI自動化**: PyAutoGUI
- **macOS統合**: PyObjC

---

**🎤 VoiceChatBot - 完全音声操作でChatGPTを使おう！**