# VoiceChatBot

MacのChatGPTアプリを**完全音声操作**するための自動化ツールです。最もシンプルなワークフローで、手軽に音声でChatGPTを操作できます。

## 🔒 セキュリティとプライバシー

- **✅ macOS専用**: macOS専用設計（Quartz、SoX、Whisper依存）
- **✅ ローカル処理**: 録音データはローカル処理のみ。外部送信なし
- **✅ 一時ファイル**: 音声ファイルは自動削除。データ蓄積なし  
- **✅ キーボード支援**: キーボード操作はユーザー入力支援目的のみ
- **✅ オープンソース**: 全コードが公開され、透明性確保

## 主な特徴

- **🎤 完全音声制御**: ターミナル入力は一切不要
- **🔄 2つの独立音声システム**: 
  - **音声入力①**: macOS純正（ChatGPT質問入力用）
  - **音声入力②**: Whisper独立音声認識（制御コマンド用）
- **⚡ 超シンプルワークフロー**: 不要な機能を削除して最小限の操作
- **🚫 終了は多言語対応**: ひらがな・漢字・カタカナ・英語すべてに対応 **🚫 終了は多言語対応**: ひらがな・漢字・カタカナ・英語すべてに対応- **🚫 終了は多言語対応**: ひらがな・漢字・カタカナ・英語すべてに対応
MacのC### 音声入力②（独立Whisper）
- **用途**: システム制御（はい/いいえ、音声入力終了等）
- **制御**: macOS `rec`コマンド + Whisper音声認識
- **動作**: ChatGPT入力とは完全に独立PTアプリを**完全音声操作**するための自動化ツールです。最もシンプルなワークフローで、手軽に音声でChatGPTを操作できます。

## 主な特徴

- **🎤 完全音声制御**: ターミナル入力は一切不要
- **🔄 2つの独立音声システム**: 
  - **音声入力①**: macOS純正（ChatGPT質問入力用）
  - **音声入力②**: Whisper独立音声認識（制御コマンド用）
- **⚡ 超シンプルワークフロー**: 不要な機能を削除して最小限の操作
- **� いいえは常に終了**: 余計な選択肢なし

## システム構成

### 音声入力①（macOS純正）
- **用途**: ChatGPTへの質問入力
- **制御**: 右コマンドキー2回押し（Quartz macOSネイティブAPI）
- **停止**: Escapeキー（Quartz macOSネイティブAPI）
- **動作**: macOSの標準音声入力機能を使用

### 音声入力②（独立Whisper）
- **用途**: システム制御（はい/いいえ、音声入力終了等）
- **制御**: macOS `rec`コマンド + Whisper音声認識
- **動作**: ChatGPT入力とは完全に独立

## 必要な環境

- **OS**: macOS 10.14以降
- **Python**: 3.9以降（3.13推奨）
- **アプリ**: ChatGPTアプリ（Mac版）
- **権限**: アクセシビリティ権限
- **音声**: macOS音声入力の有効化

## インストールと初期設定

### 1. リポジトリのクローンと依存関係インストール

```bash
git clone <repository-url>
cd VoiceChatBot
chmod +x setup.sh
./setup.sh
```

### 2. システム権限の設定

#### アクセシビリティ権限
1. **システム環境設定** > **セキュリティとプライバシー** > **プライバシー** > **アクセシビリティ**
2. ターミナル（このアプリを実行するアプリ）にチェックを入れる
3. 必要に応じてPythonやVS Codeにも権限を付与

#### 音声入力の有効化
1. **システム環境設定** > **キーボード** > **音声入力**
2. 音声入力を **「オン」** にする
3. ショートカットが **「右コマンドキーを2回押す」** になっていることを確認
4. **「拡張音声入力」** をオンにする（推奨）

#### macOS録音ツールの確認
```bash
# 録音機能の確認（SOX必要）
brew install sox
rec --version
```

### 3. ChatGPTアプリの準備
- ChatGPTアプリを起動
- ログインしてチャット画面を開く
- チャット入力欄がアクティブな状態にする

## 使用方法（完全音声操作）

### 基本的な起動手順

```bash
cd VoiceChatBot
python3 voice_chat_bot.py
```

### 📝 超シンプルワークフロー

#### 1. **準備確認**
- 🔊 「準備はできましたか？」と読み上げ
- 🎤 **音声②** で **「はい」** → 継続、**「終了」** → 終了

#### 2. **音声入力開始**
- 🔊 「お話しください」と読み上げ
- ⚡ 自動的に **音声入力①（macOS純正）** が起動

#### 3. **音声入力処理**
- 🎤 **音声①** でChatGPTに質問を話す
- 🎧 バックグラウンドで **「音声入力終了」** を検知
- ⚡ 音声入力②が「音声入力終了」を検知すると自動停止

#### 4. **自動送信**
- ⚡ Cmd+Enterで自動送信
- ✅ 完了！

### 🎯 音声コマンド

#### 音声②で認識される「はい」コマンド
- `はい` / `hai` / `yes`
- `うん` / `そうです` / `オッケー` / `ok`

#### 音声②で認識される「終了」コマンド（ひらがな・漢字・カタカナ対応）
- `終了` / `しゅうりょう` / `シュウリョウ`
- `おわり` / `オワリ` / `終わり`
- `end` / `finish` / `stop`
- `やめ` / `ヤメ` / `キャンセル` / `ストップ`

#### 音声①終了コマンド
- `音声入力終了` / `終了`

## 技術仕様

### システム構成図（簡略化版）
```
[ユーザー] 
    ↓ 音声①（ChatGPT質問）
[macOS純正音声入力] → [ChatGPTアプリ]
    ↓ 自動制御（Quartz）     ↓ 自動送信
[VoiceChatBot]
    ↑ 制御・検知
[音声②コマンド] ← [Whisper音声認識]
    ↓ 音声出力
[ユーザー]
```
[ユーザー]
```

### 主要機能

#### VoiceBot
- 超シンプルなステップバイステップ実行
- macOS純正音声入力の自動制御
- Quartz（macOSネイティブAPI）による右コマンドキー2回押し（開始）
- Quartz（macOSネイティブAPI）によるEscapeキー（停止）
- 自動送信機能（Cmd+Enter）

#### VoiceCommandRecognizer  
- 独立した音声認識システム
- macOS `rec`コマンド + Whisper
- 「はい/いいえ」判定
- 「音声入力終了」検知

### ファイル構成
```
VoiceChatBot/
├── voice_chat_bot.py              # メインアプリケーション（シンプル版）
├── voice_chat_bot_legacy.py       # 旧版（フル機能・非推奨）
├── step_by_step_voice_bot.py      # 開発用バックアップ
├── simple_voice_chat.py           # プロトタイプ
├── requirements.txt               # Python依存関係
├── setup.sh                      # セットアップスクリプト
└── README.md                     # このドキュメント
```

## トラブルシューティング

### 🎤 音声認識関連

#### 音声入力①（macOS純正）が起動しない
- **確認項目**:
  - システム環境設定 > キーボード > 音声入力が「オン」
  - ショートカットが「右コマンドキーを2回押す」
  - アクセシビリティ権限が付与されている
- **解決方法**: 手動でコマンドキー2回押しをテストする

#### 音声入力②（Whisper）が認識しない
- **確認項目**:
  - `rec`コマンドがインストールされている（`brew install sox`）
  - faster-whisperが正しくインストールされている
  - マイクへのアクセス権限がある
- **解決方法**: 
```bash
# 音声認識テスト
python3 -c "from faster_whisper import WhisperModel; print('OK')"

# 録音テスト  
rec test.wav trim 0 3
```

### 🔧 権限・設定関連

#### アクセシビリティ権限エラー
```
Privacy warning: macOS requires permission to control other applications
```
- **解決方法**:
  1. システム環境設定 > セキュリティとプライバシー > プライバシー > アクセシビリティ
  2. ターミナル・Python・VS Code等に権限を付与
  3. アプリを再起動

#### ChatGPTアプリが認識されない
- **確認項目**:
  - ChatGPTアプリが最新版
  - アプリがアクティブウィンドウになっている
  - チャット画面が開いている
- **解決方法**: ChatGPTアプリを再起動してウィンドウを前面に

### 🔊 読み上げ関連

#### 読み上げ音声が出ない
- **確認項目**:
  - システムの音量設定
  - 他のアプリが音声出力を使用していない
  - macOS `say`コマンドが動作する
- **テスト方法**:
```bash
say "テスト音声です"
```

### ⚠️ 一般的な問題

#### アプリが途中で停止する
- **ログ確認**: `voice_chat_bot.log`ファイルを確認
- **再起動**: `Ctrl+C`で終了後、再起動
- **音声入力リセット**: 手動でコマンドキー2回押しで音声入力をリセット

#### 「faster-whisper」インポートエラー
```bash
pip3 install --upgrade faster-whisper
# または
pip3 install --force-reinstall faster-whisper
```

#### 無限ループ・応答なし
- **緊急停止**: `Ctrl+C`
- **プロセス確認**: 
```bash
ps aux | grep python
kill [PID]  # 必要に応じて
```

## 開発・カスタマイズ

### 音声認識精度の調整
`voice_chat_bot.py`の以下の部分を編集:
```python
# 録音時間の調整（デフォルト5秒）
audio_file = self.record_audio_macos(duration=5)  # 5秒 → 7秒等

# 再試行時の録音時間（デフォルト4秒）
audio_file = self.record_audio_macos(duration=4)  # 4秒 → 6秒等

# 認識語彙の追加
yes_commands = ['はい', 'hai', 'yes', 'うん', 'そうです', 'オッケー', 'ok', 'そう']
```

### ログレベルの変更
```python
logging.basicConfig(level=logging.DEBUG)  # より詳細なログ
```

### Whisperモデルの変更
```python
self.model = WhisperModel("small", device="cpu")  # tiny → small（精度向上）
```

## 今後の開発予定

### 🎯 短期目標
- [ ] ChatGPT回答の自動検出（Accessibility API）
- [ ] 音声認識精度の向上
- [ ] エラーハンドリングの強化
- [ ] 設定ファイル対応

### 🚀 中期目標  
- [ ] 複数音声入力デバイス対応
- [ ] 音声コマンドの拡張（質問カテゴリ指定等）
- [ ] ログ保存・履歴機能
- [ ] GUI版の開発

### 💡 長期目標
- [ ] 他のAIチャットサービス対応
- [ ] 音声合成音質の改善
- [ ] プラグインシステム
- [ ] モバイル版対応

## 貢献・フィードバック

### バグ報告
Issueで以下の情報と共に報告してください:
- macOSバージョン
- Pythonバージョン  
- エラーログ（`voice_chat_bot.log`）
- 再現手順

### 機能提案
新機能のアイデアをIssueで共有してください。

### プルリクエスト
1. フォークしてブランチを作成
2. 機能追加・修正を実装
3. テストを追加・実行  
4. プルリクエストを作成

## セキュリティとプライバシー

### 🔒 セキュリティ設計

- **ローカル実行**: 全ての処理はローカルで実行され、外部サーバーとの通信は一切ありません
- **データ保護**: 音声データは一時的にのみ保存され、処理後は自動削除されます
- **最小権限**: 必要最小限のシステム権限のみを要求します
- **オープンソース**: コードは完全に公開されており、動作を検証可能です

### 🛡️ 必要な権限

このアプリケーションは以下のmacOSシステム権限が必要です：

1. **アクセシビリティ権限**: 他のアプリケーション（ChatGPT）の制御
2. **マイクアクセス**: 音声認識機能
3. **音声入力権限**: macOS標準音声入力の制御

これらの権限は機能実現のために必要で、悪用されることはありません。

### 📝 プライバシー

- **音声データ**: ローカルで処理され、外部に送信されません
- **チャット内容**: ChatGPTアプリ内でのみ処理され、このツールでは保存されません
- **ログファイル**: システム動作ログのみが記録され、個人情報は含まれません

### ⚠️ 使用上の注意

- 信頼できる環境でのみ使用してください
- 定期的にログファイル（voice_chat_bot.log）を確認してください
- システム権限の付与は慎重に行ってください

## ライセンス

MIT License - 詳細は`LICENSE`ファイルを参照

## 作成者・クレジット

- **開発**: VoiceChatBot Project
- **音声認識**: faster-whisper (OpenAI Whisper)
- **TTS**: macOS標準 say コマンド
- **UI自動化**: Quartz（macOSネイティブAPI）
- **macOS統合**: PyObjC

---

**🎤 VoiceChatBot - 完全音声操作でChatGPTを使おう！**